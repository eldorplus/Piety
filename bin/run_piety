#!/usr/bin/env python
"""
Start a Piety session running in an interactive Python session

 python -i run_piety

If you exit from Piety or interrupt it, you will still be in Python
and can resume your Piety session with r()

You can also start a standalone Piety session at the command line:

 run_piety

But here, if you exit or interrupt Piety you will also exit Python.  

"""

import sys

import console
import pysht
import piety

def run_piety():
    """ 
    setup terminal and (re)start piety
    must be one command at the python prompt
    """
    piety.done = False # reset, might be resuming after piety.exit() 
    shell.restart() # clear buffer, print prompt
    piety.run(nevents=0) # loop forever, don't return

r = run_piety # abbreviation, 'resume'

shell = console.Console(command=pysht.mk_shell(), exiter=piety.exit)
t0 = piety.Task(handler=shell.getchar, event=piety.sys.stdin)

if __name__ == '__main__':
    run_piety()
